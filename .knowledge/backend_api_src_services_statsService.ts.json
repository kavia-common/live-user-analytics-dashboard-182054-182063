{"is_source_file": true, "format": "TypeScript", "description": "This file provides statistical functions for activity events, including overview counts, timeseries data, device breakdown, and location breakdown for a dashboard in a user analytics system.", "external_files": ["../models/ActivityEvent.js", "../models/Session.js"], "external_methods": ["ActivityEvent.countDocuments", "ActivityEvent.distinct", "ActivityEvent.aggregate", "Session.countDocuments"], "published": ["overviewStats", "timeseriesStats", "deviceBreakdown", "locationBreakdown"], "classes": [], "methods": [{"name": "export async function overviewStats(sinceMinutes = 60) { overviewStats", "description": "Returns high-level counts such as total users, active sessions, total events, and unique users in a specified time window.", "scope": "", "scopeKind": ""}, {"name": "export async function timeseriesStats(intervalMinutes = 5, totalMinutes = 60) { timeseriesStats", "description": "Provides per-interval counts of events and unique users over time.", "scope": "", "scopeKind": ""}, {"name": "export async function deviceBreakdown(sinceMinutes = 60) { deviceBreakdown", "description": "Aggregates activity events by device type, OS, and browser within a time window.", "scope": "", "scopeKind": ""}, {"name": "export async function locationBreakdown(sinceMinutes = 60) { locationBreakdown", "description": "Aggregates activity events by country and region within a time window.", "scope": "", "scopeKind": ""}], "calls": ["Session.countDocuments", "ActivityEvent.countDocuments", "ActivityEvent.distinct", "ActivityEvent.aggregate"], "search-terms": ["statsService", "overviewStats", "timeseriesStats", "deviceBreakdown", "locationBreakdown", "ActivityEvent", "Session", "dashboard", "analytics", "statistics"], "state": 2, "file_id": 27, "knowledge_revision": 352, "git_revision": "6241b6678d4ba4937d8c14a0c734b886660ccbf2", "revision_history": [{"59": ""}, {"352": "6241b6678d4ba4937d8c14a0c734b886660ccbf2"}], "ctags": [{"_type": "tag", "name": "$group", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^      $group: {$/", "language": "TypeScript", "kind": "constant", "scope": "deviceBreakdown", "scopeKind": "function"}, {"_type": "tag", "name": "$group", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^      $group: {$/", "language": "TypeScript", "kind": "constant", "scope": "locationBreakdown", "scopeKind": "function"}, {"_type": "tag", "name": "$group", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^      $group: {$/", "language": "TypeScript", "kind": "constant", "scope": "timeseriesStats", "scopeKind": "function"}, {"_type": "tag", "name": "$sort", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^    { $sort: { _id: 1 } },$/", "language": "TypeScript", "kind": "constant", "scope": "timeseriesStats", "scopeKind": "function"}, {"_type": "tag", "name": "activeSessions", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const [activeSessions, eventsCount, uniqueUsersWindow, totalUsers] = await Promise.all([$/", "language": "TypeScript", "kind": "constant", "scope": "overviewStats", "scopeKind": "function"}, {"_type": "tag", "name": "bucketExpr", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const bucketExpr = {$/", "language": "TypeScript", "kind": "constant", "scope": "timeseriesStats", "scopeKind": "function"}, {"_type": "tag", "name": "bucketMs", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const bucketMs = clampedInterval * 60 * 1000;$/", "language": "TypeScript", "kind": "constant", "scope": "timeseriesStats", "scopeKind": "function"}, {"_type": "tag", "name": "clampedInterval", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const clampedInterval = Math.max(1, Math.min(60 * 24, Number(intervalMinutes) || 5));$/", "language": "TypeScript", "kind": "constant", "scope": "timeseriesStats", "scopeKind": "function"}, {"_type": "tag", "name": "clampedTotal", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const clampedTotal = Math.max(clampedInterval, Math.min(60 * 24 * 7, Number(totalMinutes) || 6/", "language": "TypeScript", "kind": "constant", "scope": "timeseriesStats", "scopeKind": "function"}, {"_type": "tag", "name": "count", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^        count: { $sum: 1 },$/", "language": "TypeScript", "kind": "constant", "scope": "timeseriesStats", "scopeKind": "function"}, {"_type": "tag", "name": "deviceBreakdown", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^export async function deviceBreakdown(sinceMinutes = 60) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "eventsCount", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const [activeSessions, eventsCount, uniqueUsersWindow, totalUsers] = await Promise.all([$/", "language": "TypeScript", "kind": "constant", "scope": "overviewStats", "scopeKind": "function"}, {"_type": "tag", "name": "locationBreakdown", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^export async function locationBreakdown(sinceMinutes = 60) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "overviewStats", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^export async function overviewStats(sinceMinutes = 60) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "pipeline", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const pipeline = [$/", "language": "TypeScript", "kind": "constant", "scope": "deviceBreakdown", "scopeKind": "function"}, {"_type": "tag", "name": "pipeline", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const pipeline = [$/", "language": "TypeScript", "kind": "constant", "scope": "locationBreakdown", "scopeKind": "function"}, {"_type": "tag", "name": "pipeline", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const pipeline = [$/", "language": "TypeScript", "kind": "constant", "scope": "timeseriesStats", "scopeKind": "function"}, {"_type": "tag", "name": "rows", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const rows = await ActivityEvent.aggregate(pipeline);$/", "language": "TypeScript", "kind": "constant", "scope": "deviceBreakdown", "scopeKind": "function"}, {"_type": "tag", "name": "rows", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const rows = await ActivityEvent.aggregate(pipeline);$/", "language": "TypeScript", "kind": "constant", "scope": "locationBreakdown", "scopeKind": "function"}, {"_type": "tag", "name": "rows", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const rows = await ActivityEvent.aggregate(pipeline);$/", "language": "TypeScript", "kind": "constant", "scope": "timeseriesStats", "scopeKind": "function"}, {"_type": "tag", "name": "since", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const since = new Date(Date.now() - clampedTotal * 60 * 1000);$/", "language": "TypeScript", "kind": "constant", "scope": "timeseriesStats", "scopeKind": "function"}, {"_type": "tag", "name": "since", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const since = new Date(Date.now() - sinceMinutes * 60 * 1000);$/", "language": "TypeScript", "kind": "constant", "scope": "deviceBreakdown", "scopeKind": "function"}, {"_type": "tag", "name": "since", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const since = new Date(Date.now() - sinceMinutes * 60 * 1000);$/", "language": "TypeScript", "kind": "constant", "scope": "locationBreakdown", "scopeKind": "function"}, {"_type": "tag", "name": "since", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const since = new Date(Date.now() - sinceMinutes * 60 * 1000);$/", "language": "TypeScript", "kind": "constant", "scope": "overviewStats", "scopeKind": "function"}, {"_type": "tag", "name": "timeseriesStats", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^export async function timeseriesStats(intervalMinutes = 5, totalMinutes = 60) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "totalUsers", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const [activeSessions, eventsCount, uniqueUsersWindow, totalUsers] = await Promise.all([$/", "language": "TypeScript", "kind": "constant", "scope": "overviewStats", "scopeKind": "function"}, {"_type": "tag", "name": "uniqueUsersWindow", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/services/statsService.ts", "pattern": "/^  const [activeSessions, eventsCount, uniqueUsersWindow, totalUsers] = await Promise.all([$/", "language": "TypeScript", "kind": "constant", "scope": "overviewStats", "scopeKind": "function"}], "hash": "dac9d4f5d88964f4c71d1839dbf66e96", "format-version": 4, "code-base-name": "frontend_dashboard", "filename": "backend_api/src/services/statsService.ts"}