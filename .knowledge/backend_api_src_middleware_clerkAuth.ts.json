{"is_source_file": true, "format": "TypeScript", "description": "This source file defines an Express middleware function 'clerkAuthMiddleware' that handles Clerk JWT authentication. It verifies the JWT, extracts user info, assigns roles based on email, and attaches the user to the request object. It also manages error handling and logging.", "external_files": ["@clerk/clerk-sdk-node", "../config/env.js", "../utils/debug.js", "express"], "external_methods": ["getAuth", "getEnv", "debugLog", "debugError"], "published": ["clerkAuthMiddleware"], "classes": [{"name": "AuthUser", "description": "Interface representing authenticated user info with id, email, and role."}], "methods": [{"name": "export async function clerkAuthMiddleware(req: Request, res: Response, next: NextFunction) { clerkAuthMiddleware", "description": "Express middleware that verifies Clerk JWT, assigns user role based on email, and attaches user info to the request object.", "scope": "", "scopeKind": ""}], "calls": ["getAuth", "getEnv", "debugLog", "debugError"], "search-terms": ["clerkAuthMiddleware", "JWT verification", "Clerk SDK", "Express middleware", "role-based auth", "sessionClaims"], "state": 2, "file_id": 68, "knowledge_revision": 340, "git_revision": "07d4245a3430bae5be44c35d7f23ed6e956e133e", "revision_history": [{"193": ""}, {"340": "07d4245a3430bae5be44c35d7f23ed6e956e133e"}], "ctags": [{"_type": "tag", "name": "ADMIN_EMAILS", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/middleware/clerkAuth.ts", "pattern": "/^  const { ADMIN_EMAILS } = getEnv();$/", "language": "TypeScript", "kind": "constant", "scope": "clerkAuthMiddleware", "scopeKind": "function"}, {"_type": "tag", "name": "AuthUser", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/middleware/clerkAuth.ts", "pattern": "/^export interface AuthUser {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "Express", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/middleware/clerkAuth.ts", "pattern": "/^  namespace Express {$/", "language": "TypeScript", "kind": "namespace"}, {"_type": "tag", "name": "Request", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/middleware/clerkAuth.ts", "pattern": "/^    interface Request {$/", "language": "TypeScript", "kind": "interface", "scope": "Express", "scopeKind": "namespace"}, {"_type": "tag", "name": "auth", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/middleware/clerkAuth.ts", "pattern": "/^    const auth = getAuth(req as any);$/", "language": "TypeScript", "kind": "constant", "scope": "clerkAuthMiddleware", "scopeKind": "function"}, {"_type": "tag", "name": "claims", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/middleware/clerkAuth.ts", "pattern": "/^    const claims = (auth as any).sessionClaims || {};$/", "language": "TypeScript", "kind": "constant", "scope": "clerkAuthMiddleware", "scopeKind": "function"}, {"_type": "tag", "name": "clerkAuthMiddleware", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/middleware/clerkAuth.ts", "pattern": "/^export async function clerkAuthMiddleware(req: Request, res: Response, next: NextFunction) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/middleware/clerkAuth.ts", "pattern": "/^    const email: string =$/", "language": "TypeScript", "kind": "constant", "scope": "clerkAuthMiddleware", "scopeKind": "function"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/middleware/clerkAuth.ts", "pattern": "/^  email: string;$/", "language": "TypeScript", "kind": "property", "scope": "AuthUser", "scopeKind": "interface"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/middleware/clerkAuth.ts", "pattern": "/^  id: string;$/", "language": "TypeScript", "kind": "property", "scope": "AuthUser", "scopeKind": "interface"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/middleware/clerkAuth.ts", "pattern": "/^    const role: 'admin' | 'user' =$/", "language": "TypeScript", "kind": "constant", "scope": "clerkAuthMiddleware", "scopeKind": "function"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/middleware/clerkAuth.ts", "pattern": "/^  role: 'admin' | 'user';$/", "language": "TypeScript", "kind": "property", "scope": "AuthUser", "scopeKind": "interface"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/live-user-analytics-dashboard-182054-182063/backend_api/src/middleware/clerkAuth.ts", "pattern": "/^      user?: AuthUser;$/", "language": "TypeScript", "kind": "property", "scope": "Express.Request", "scopeKind": "interface"}], "hash": "30768d2bd3e3ddea7e55f9ba7d146ada", "format-version": 4, "code-base-name": "frontend_dashboard", "filename": "backend_api/src/middleware/clerkAuth.ts", "fields": [{"name": "export interface AuthUser {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "interface Request {", "scope": "Express", "scopeKind": "namespace", "description": "unavailable"}, {"name": "email: string;", "scope": "AuthUser", "scopeKind": "interface", "description": "unavailable"}, {"name": "id: string;", "scope": "AuthUser", "scopeKind": "interface", "description": "unavailable"}, {"name": "role: 'admin' | 'user';", "scope": "AuthUser", "scopeKind": "interface", "description": "unavailable"}, {"name": "user?: AuthUser;", "scope": "Express.Request", "scopeKind": "interface", "description": "unavailable"}]}